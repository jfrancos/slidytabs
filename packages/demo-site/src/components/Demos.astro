---
import { frameworks } from "@/lib/store";
import Demo from "./Demo.astro";
import SelectFramework from "./SelectFramework.svelte";

interface Props {
  filename: string;
}
const { filename } = Astro.props;
const examples = import.meta.glob(
  "../frameworks/*/examples/*.{tsx,react,svelte,vue,solid,astro}"
);

const langForFramework = (framework: string) =>
  framework === "react" ? "tsx" : framework;

const exists = (framework: string) =>
  Object.keys(examples).some((path) =>
    path.endsWith(
      `/frameworks/${framework}/examples/${filename}.${langForFramework(framework)}`
    )
  );

const codes = Object.fromEntries(frameworks.map((item) => [item, ""]));

let minLines = Infinity;
for (const framework of frameworks.filter(exists)) {
  const { default: raw } = await import(
    `../frameworks/${framework}/examples/${filename}.${langForFramework(framework)}?raw`
  );
  codes[framework] = raw;
  minLines = Math.min(minLines, raw.split("\n").length);
}

const height = filename === "Sticky" ? 256 : 224;
---

<div class="flex flex-col gap-3">
  <SelectFramework {filename} client:load />
  <div class="relative" style={{ height: `${height + minLines * 20}px` }}>
    {
      frameworks.filter(exists).map((framework) => (
        <div class="absolute inset-0">
          <Demo {framework} {filename} raw={codes[framework]} {minLines} />
        </div>
      ))
    }
  </div>
</div>
