---
import { codeToHtml, type BundledLanguage } from "shiki";

interface Props {
  code: string;
  highlight?: { start: number; end: number }[];
  lang: BundledLanguage;
  class?: string;
  lineNumbers?: boolean;
  height?: number;
}
const {
  code,
  highlight,
  lang,
  class: className,
  lineNumbers = true,
  height,
} = Astro.props;
const html = codeToHtml(code, {
  lang,
  theme: "github-light",
  decorations: highlight?.map(({ start, end }) => ({
    start,
    end,
    properties: { class: "highlight" },
  })),
});
---

<div
  style={{ height: `${height}px` }}
  set:html={html}
  class:list={[
    "children:(text-sm px-6 py-5 !bg-neutral-100 overflow-scroll h-full)",
    className,
    lineNumbers && "line-numbers",
  ]}
/>

<!-- index from 0 since the first-line comments don't actually exist -->
<style is:global>
  .shiki {
    counter-reset: step;
    counter-increment: step 0;
  }
  :not(.line-numbers) > .shiki .line::before {
    display: none;
  }
  .shiki .line::before {
    content: counter(step);
    counter-increment: step;
    width: 1rem;
    margin-right: 1.5rem;
    display: inline-block;
    text-align: right;
    color: rgba(115, 138, 148, 0.4);
  }
</style>
