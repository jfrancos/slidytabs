---
import { Code as AstroCode } from "astro:components";
import { transformerMetaWordHighlight } from "@shikijs/transformers";
import type { CodeLanguage } from "astro";

interface Props {
  code: string;
  lang: CodeLanguage;
  class?: string;
  lineNumbers?: boolean;
  height?: number;
  highlightedCode?: string;
}

const {
  code,
  lang,
  class: className,
  lineNumbers = true,
  height,
  highlightedCode,
} = Astro.props;

// This is what gets green highlights
const meta = [
  highlightedCode,
  'import { tabs } from "slidytabs";',
  '  import { tabs } from "slidytabs";',
  'import { slider } from "slidytabs";',
  '  import { slider } from "slidytabs";',
  'import { slider, type SliderOptions } from "slidytabs";',
  '  import { slider, type SliderOptions } from "slidytabs";',
  'import { range, type RangeValue } from "slidytabs";',
  '  import { range, type RangeValue } from "slidytabs";',
]
  .map((item) => `/${item}/`)
  .join("");
---

<div style={{ height: `${height}px` }}>
  <AstroCode
    transformers={[transformerMetaWordHighlight()]}
    {meta}
    {code}
    {lang}
    theme="github-light"
    class:list={[
      "text-sm px-6 py-5 bg-muted! h-full",
      className,
      lineNumbers && "line-numbers",
    ]}
  />
</div>

<style is:global>
  .astro-code {
    counter-reset: step;
    counter-increment: step 0;
  }
  :not(.line-numbers).astro-code .line::before {
    display: none;
  }
  .astro-code .line::before {
    content: counter(step);
    counter-increment: step;
    width: 1rem;
    margin-right: 1.5rem;
    display: inline-block;
    text-align: right;
    color: rgba(115, 138, 148, 0.4);
  }
</style>
