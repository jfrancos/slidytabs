---
import Code from "./Code.astro";
import SvelteShell from "./svelte/Shell.svelte";
import TsxShell from "./tsx/Shell.tsx";
import VueShell from "./vue/Shell.vue";
import { react, svelte, vue } from "./icons";
import {
  extractRef,
  extractAttachment,
  extractVueRef,
} from "../lib/findHighlight.ts";

interface Props {
  filename: string;
  lang: "tsx" | "svelte" | "vue";
}

const { filename, lang } = Astro.props;
const { default: Component } = await import(
  `./${lang}/examples/${filename}.${lang}`
);
const { default: raw } = await import(
  `./${lang}/examples/${filename}.${lang}?raw`
);

const highlight = {
  tsx: extractRef,
  svelte: extractAttachment,
  vue: extractVueRef,
}[lang]?.(raw);
const prefix = {
  svelte: `<!-- ${filename}.svelte -->`,
  vue: `<!-- ${filename}.vue -->`,
  tsx: `// ${filename}.tsx`,
}[lang];
const logos = {
  [react]: lang === "tsx",
  [svelte]: lang === "svelte",
  [vue]: lang === "vue",
};
const code = `${prefix}\n${raw}`;
---

<div
  class="flex flex-col border-gray-100 border-4 rounded-lg max-w-[calc(100vw-4rem)] w-2xl relative"
>
  <div class="flex justify-center h-32 items-center relative select-none">
    <div
      class:list={[
        logos,
        "text-xl absolute top-4 right-4 z-10 min-[28rem]:opacity-100 opacity-50",
      ]}
    >
    </div>
    {lang === "svelte" && <SvelteShell {filename} client:idle />}
    {lang === "tsx" && <TsxShell {filename} client:idle />}
    {lang === "vue" && <VueShell {filename} client:idle />}
    <!-- flash between SSR awaited component and client awaited component so we
    have both simultaneously and hide the SSR once the client is visible -->
    <div class="[:has(*)~&]:hidden">
      <Component />
    </div>
  </div>
  <Code {highlight} {code} {lang} />
</div>
